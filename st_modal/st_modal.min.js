class st_modal{static#t=Symbol();modal;overlay;container;content;#e={};#s={};#i="hidden";static#o(t){try{return t instanceof Element?t:document.querySelector(t)}catch{return}}static find(t){return st_modal.#o(t)[st_modal.#t]}get state(){return this.#i}get params(){return this.#e}clone(t){let e=this.content.cloneNode(!0);return e.id=t.id??(e.id||"modal").replace(/#+$/,"")+(t.suffix??"_copy"),new st_modal({...this.#e,...this.#s,content:e,...t,parent:this})}constructor(t){let e,s,i;t={zIndex:1e3,duration:0,container:"body",overlay:!0,overlay_shading:.5,overlay_blur:"5px",overlay_scroll_lock:!0,content:"<div></div>",location:"center center",trigger:null,close_by_overlay:!0,close_by_esc:!0,auto_close:-1,allow_interrupt:!1,before_show:()=>{},on_show:()=>{},before_hide:()=>{},on_hide:()=>{},before_init:()=>{},on_init:()=>{},...t};for(let[e,s]of Object.entries(t))"function"==typeof s?(this[e]=s.bind(this),this.#s[e]=s):this.#e[e]=s;this.before_init(this.#e),this.modal=document.createElement("modal"),this.modal[st_modal.#t]=this,Object.assign(this.modal.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:this.#e.zIndex,transition:`all ${this.#e.duration}s`,pointerEvents:"none",display:"none"}),this.modal.setAttribute("state","hidden");try{st_modal.#o(this.#e.container).append(this.modal)}catch{throw new Error("Неудачная попытка вставить модальное окно в указанный контейнер")}this.#e.overlay&&(this.overlay=document.createElement("overlay"),this.overlay[st_modal.#t]=this,Object.assign(this.overlay.style,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:`rgba(0, 0, 0, ${this.#e.overlay_shading})`,backdropFilter:`blur(${this.#e.overlay_blur})`,zIndex:++this.#e.zIndex,transition:"inherit",pointerEvents:"all"}),this.modal.append(this.overlay),this.#e.close_by_overlay&&this.overlay.addEventListener("click",()=>this.hide(this.overlay))),this.container=document.createElement("container"),this.container[st_modal.#t]=this,Object.assign(this.container.style,{position:"absolute",overflow:"hidden",width:"max-content",height:"max-content",maxWidth:"100vw",maxHeight:"100vh",zIndex:++this.#e.zIndex,transition:"inherit",pointerEvents:"all",...(()=>{let t=(this.#e.location||"").toLowerCase().split(/\s+/),e={top:t.includes("top")?0:t.includes("bottom")?void 0:"50%",bottom:t.includes("bottom")?0:void 0,left:t.includes("left")?0:t.includes("right")?void 0:"50%",right:t.includes("right")?0:void 0},s="50%"===e.left?"translateX(-50%)":"",i="50%"===e.top?"translateY(-50%)":"";return(s||i)&&(e.transform=`${s} ${i}`.trim()),e})()}),this.modal.append(this.container);try{this.content=st_modal.#o(this.#e.content)??(new DOMParser).parseFromString(this.#e.content,"text/html").body.firstElementChild}catch{throw new Error("Неудачная попытка вставить переданный контент в модальное окно")}this.container.append(this.content),this.content[st_modal.#t]=this,this.content.style.transition="inherit",this.content.querySelectorAll('[action="close"]').forEach(t=>{t.addEventListener("click",()=>this.hide())});let o=t=>{t.before_func(t.data),clearTimeout(e),this.modal.style.display="block",requestAnimationFrame(()=>{this.#i=t.process,this.modal.setAttribute("state",this.#i),requestAnimationFrame(()=>{e=setTimeout(()=>{this.#i=t.final,this.modal.setAttribute("state",this.#i),t.hide&&(this.modal.style.display="none"),t.after_func(t.data)},1e3*this.#e.duration)})})};this.show=(t=null)=>{("hidden"==this.#i||this.#e.allow_interrupt&&"hiding"==this.#i)&&(o({before_func:this.before_show,after_func:this.on_show,process:"showing",final:"shown",hide:!1,data:t}),this.#e.overlay_scroll_lock&&this.overlay&&(i=document.documentElement.style.scrollBehavior,s=document.body.style,s={position:s.position,top:s.top,left:s.left,width:s.width,scroll_Y:window.scrollY||document.documentElement.scrollTop,scroll_X:window.scrollX||document.documentElement.scrollLeft},document.documentElement.style.scrollBehavior="unset",Object.assign(document.body.style,{position:"fixed",width:"100vw",top:`-${s.scroll_Y}px`,left:`-${s.scroll_X}px`})),this.#e.auto_close>0&&(clearTimeout(e),e=setTimeout(()=>{this.hide()},1e3*this.#e.auto_close)))},this.hide=(t=null)=>{("shown"==this.#i||this.#e.allow_interrupt&&"showing"==this.#i)&&(o({before_func:this.before_hide,after_func:this.on_hide,process:"hiding",final:"hidden",hide:!0,data:t}),clearTimeout(e),e=setTimeout(()=>{s&&(Object.assign(document.body.style,s),window.scrollTo(s.scroll_X,s.scroll_Y)),null!=i&&(document.documentElement.style.scrollBehavior=i)},1e3*this.#e.duration))},this.#e.close_by_esc&&document.addEventListener("keydown",t=>{"Escape"!==t.code&&27!==t.keyCode||this.hide(t)}),this.#e.trigger&&document.querySelectorAll(this.#e.trigger).forEach(t=>{t.addEventListener("click",()=>this.show(t))}),this.on_init(this.#e)}}