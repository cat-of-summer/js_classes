class st_modal{static instance=Symbol();overlay;container;target;#t;static#e(t){if(t instanceof Element)return t;try{return document.querySelector(t)||(()=>{throw new Error})()}catch{return document.body.appendChild((new DOMParser).parseFromString(t,"text/html").body.firstElementChild)}}static find(t){return t[st_modal.instance]}constructor(t){t={zIndex:1e3,duration:.3,container:"body",overlay:!0,overlay_shading:.5,overlay_blur:"5px",overlay_scroll_lock:!0,location:"center center",position:"fixed",overflow:"auto",close_by_out:!0,close_by_esc:!0,auto_close:-1,close_button_attribute:'action="close"',state_attrubite:"state",allow_interrupt:!1,showing_state:"showing",shown_state:"shown",hiding_state:"hiding",hidden_state:"hidden",before_open:()=>{},on_open:()=>{},before_close:()=>{},on_close:()=>{},...t};let e,o=[],s=[];t.overlay&&(t.zIndex++,this.overlay=document.createElement("overlay"),this.overlay[st_modal.instance]=this,Object.assign(this.overlay.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:`rgba(0, 0, 0, ${t.overlay_shading})`,backdropFilter:`blur(${t.overlay_blur})`,zIndex:t.zIndex,transition:`all ${t.duration}s`,display:"none"}),this.overlay.setAttribute(t.state_attrubite,t.hidden_state),t.close_by_out&&this.overlay.addEventListener("click",()=>this.hide()),s.push(this.overlay)),this.container=document.createElement("container"),this.container[st_modal.instance]=this,Object.assign(this.container.style,{position:t.position,overflow:t.overflow,width:"max-content",maxWidth:"100%",height:"max-content",zIndex:t.zIndex+1,transition:`all ${t.duration}s`,display:"none",...{"top left":{top:0,left:0},"top center":{top:0,left:"50%",transform:"translateX(-50%)"},"top right":{top:0,right:0},"center left":{top:"50%",left:0,transform:"translateY(-50%)"},"center center":{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"center right":{top:"50%",right:0,transform:"translateY(-50%)"},"bottom left":{bottom:0,left:0},"bottom center":{bottom:0,left:"50%",transform:"translateX(-50%)"},"bottom right":{bottom:0,right:0}}[t.location]}),this.container.setAttribute(t.state_attrubite,t.hidden_state),s.push(this.container),this.target=st_modal.#e(t.target),this.target[st_modal.instance]=this,this.target.style.transition=`all ${t.duration}s`,this.container.append(this.target),this.target.querySelectorAll(`[${t.close_button_attribute}]`).forEach(t=>{t.addEventListener("click",()=>this.hide())}),t.close_by_out&&document.addEventListener("click",t=>{this.container.contains(t.target)||this.hide()}),t.close_by_esc&&document.addEventListener("keydown",t=>{"Escape"!==t.code&&27!==t.keyCode||this.hide()});let n=(e,n,i,a,r)=>{e(),s.forEach((e,s)=>{clearTimeout(o[s]),e.style.display="block",o[s]=setTimeout(()=>{this.#t=a,e.setAttribute(t.state_attrubite,this.state),r&&(e.style.display="none"),n()},1e3*t.duration),requestAnimationFrame(()=>{this.#t=i,e.setAttribute(t.state_attrubite,this.state)})})};this.show=(s=!1)=>{(this.#t==t.hidden_state||t.allow_interrupt&&this.#t==t.hiding_state||s)&&(n(t.before_open,t.on_open,t.showing_state,t.shown_state,!1),t.overlay_scroll_lock&&this.overlay&&(e=document.body.style,e={position:e.position,top:e.top,left:e.left,scroll_Y:window.scrollY||document.documentElement.scrollTop,scroll_X:window.scrollX||document.documentElement.scrollLeft},Object.assign(document.body.style,{position:"fixed",top:`-${e.scroll_Y}px`,left:`-${e.scroll_X}px`})),t.auto_close>0&&(clearTimeout(o[2]),o[2]=setTimeout(()=>{this.hide(!0)},1e3*t.auto_close)))},this.hide=(o=!1)=>{(this.#t==t.shown_state||t.allow_interrupt&&this.#t==t.showing_state||o)&&(n(t.before_close,t.on_close,t.hiding_state,t.hidden_state,!0),e&&(Object.assign(document.body.style,e),window.scrollTo(e.scroll_X,e.scroll_Y)))},this.#t=t.hidden_state,st_modal.#e(t.container).append(...s)}get state(){return this.#t}}